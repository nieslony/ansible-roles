lvm_volume: var_www

krb_ccache_dir: /var/www/client_ccache

packages:
    - httpd
    - mod_auth_gssapi
    - mod_session
    - mod_ssl
    - python3-urllib-gssapi
#ssl_key_file: "/etc/pki/tls/private/{{ ansible_fqdn }}.key"
#ssl_cert_file: "/etc/pki/tls/certs/{{ ansible_fqdn }}.crt"

whoami_packages:
    - python3-flask
    - python3-ldap3
    - python3-mod_wsgi
whoami_folder: /var/www/whoami

vhost_names: >-
    {%- set vhn = [] -%}
    {%- for vh in webserver_vhosts -%}
        {%- if vh.name is defined -%}
            {{ vhn.append(vh.name) }}
        {%- else -%}
            {{ vhn.append(vh) }}
        {%- endif -%}
    {%- endfor -%}
    {{ vhn }}

vhost_aliases: "{{ vhost_names | difference([ansible_fqdn]) }}"

vhosts_internal: >-
    {%- set hosts = [] -%}
    {%- for vh in vhost_names -%}
    {%- for dom in ipa_dns_domains -%}
        {%- if vh.endswith("." + dom) -%}
        {{ hosts.append(vh) }}
        {%- endif -%}
    {%- endfor -%}
    {%- endfor -%}
    {{ hosts }}

vhosts_external:   >-
    {% set hosts = [] %}
    {%- for vh in vhost_names -%}
    {%- if (query('community.dns.lookup', vh, server='8.8.8.8') | length) > 0 -%}
        {{ hosts.append(vh) }}
    {%- endif -%}
    {%- endfor -%}
    {{ hosts }}
